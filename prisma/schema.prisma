
generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  role      String   @default("staff") // admin, staff
  hospital  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Patient {
  id           String             @id @default(uuid())
  nationalId   String?            @unique // เลขบัตร ปชช. (ควรเข้ารหัสถ้าเป็นไปได้)
  firstName    String?
  lastName     String?
  gender       String?
  birthDate    DateTime?
  phone        String?
  addressData  Json? // เก็บที่อยู่และข้อมูลอื่นๆ จาก Part 1 ถ้ามีเยอะ
  submissions  SurveySubmission[]
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
}

model SurveySubmission {
  id                   String   @id @default(uuid())
  patientId            String
  patient              Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)
  
  // Context การเก็บข้อมูล
  region               String   // "phetchabun" | "satun" | "lopburi" | "central"
  hospital             String?  // ชื่อโรงพยาบาลที่เก็บข้อมูล
  submittedByUserId    String?  // userId ของ User ที่บันทึก (อ้างอิงจาก Clerk)
  
  // ข้อมูลจากการทำแบบสอบถาม
  totalScorePart4      Int?
  scoreBySection       Json?    // e.g. {"daily_activities": 24, "symptoms": 10, "psychosocial": 45, "satisfaction": 20}
  interpretationResult String?  // e.g. "กลุ่มเสี่ยงสูง", "ปกติ"
  
  // เก็บคำตอบดิบทั้งหมดเผื่อคำนวณใหม่
  rawAnswers           Json?    // e.g. {"q1": 5, "q2": 1, ...}
  
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  // Indexes สำหรับ query performance
  @@index([patientId])
  @@index([region])
  @@index([createdAt])
  @@index([submittedByUserId])
}

